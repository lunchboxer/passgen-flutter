# Software Design Document: Passgen

## 1. Executive Summary

Passgen is a lightweight Android application designed to generate secure xkcd-style passwords with customizable parameters. This document outlines the technical design for implementing a Flutter-based solution that meets all specified requirements while adhering to the principles of simplicity, security, and performance.

Key Design Decisions:
- Single-Activity architecture for minimal resource usage
- Provider-based state management for efficient UI updates
- Embedded assets for offline operation
- Zero-permission security model
- Pre-processed word lists for performance optimization

## 2. System Overview and Architecture

### 2.1 Architecture Diagram
```
[Presentation Layer (Flutter UI)]
        ↓
[Application Layer (Business Logic)]
        ↓
[Data Layer (Embedded Assets)]
        ↑
[Persistence Layer (SharedPreferences)]
```

### 2.2 Architectural Patterns
- **MVVM with Provider**: 
  - Clear separation between UI and business logic
  - Easy state management across the application
  - Testable components with minimal dependencies
- **Repository Pattern**:
  - Encapsulates word list access
  - Provides abstraction for potential future data source changes

## 3. High-Level System Design

### 3.1 System Flow
1. App Launch → Load Default Settings
2. Initialize Password Generator with Settings
3. Load Word Lists from Assets
4. Generate Initial Password
5. User Interaction Cycle:
   - Modify Parameters → Regenerate Password
   - Copy to Clipboard
   - Adjust Settings

### 3.2 Key Modules
- Password Generation Service
- Word Repository
- Settings Manager
- UI Components
- Clipboard Handler

## 4. Component Architecture

### 4.1 PasswordGeneratorService
- **Responsibilities**:
  - Create passwords based on specified rules
  - Enforce length constraints
  - Apply formatting (capitalization, separators)
- **Dependencies**: WordRepository
- **Methods**:
  - `generatePassword(PasswordParams params): String`
  - `validateParams(PasswordParams params): bool`

### 4.2 WordRepository
- **Responsibilities**:
  - Load word lists from assets
  - Provide random word selection
  - Filter words by length when needed
- **Assets**:
  - `words.txt` (primary dictionary)
  - `shortwords.txt` (for length-constrained cases)

### 4.3 SettingsManager
- **Responsibilities**:
  - Load/save user preferences
  - Provide default values
  - Persist settings using SharedPreferences
- **Storage Schema**:
  ```dart
  {
    "wordCount": 3,
    "capitalize": true,
    "separator": "-",
    "appendNumber": false,
    "appendSymbol": false,
    "lengthConstraint": null
  }
  ```

### 4.4 UI Components
- MainScreen:
  - PasswordDisplayWidget
  - ParameterControlsPanel
  - ActionButtonsRow
- SettingsScreen:
  - SettingsForm
  - ValidationFeedback

## 5. Data Architecture

### 5.1 Data Flow
```
Asset Bundle (Words) → WordRepository → PasswordGenerator
SharedPreferences ↔ SettingsManager ↔ UI
```

### 5.2 Data Structures
```dart
class PasswordParams {
  int wordCount;
  bool capitalize;
  String separator;
  bool appendNumber;
  bool appendSymbol;
  int? lengthConstraint;
}

// Word lists stored as in-memory Lists after asset loading
List<String> primaryWordList;
List<String> shortWordList;
```

### 5.3 Asset Management
- Words packaged as assets during build
- Pre-loaded at startup for performance
- Memory-efficient storage using Dart Lists
- Fallback to shorter word list when length constraints apply

## 6. API Design and Interfaces

### 6.1 Internal APIs
**WordRepository Interface**
```dart
abstract class IWordRepository {
  Future<void> initialize();
  String getRandomWord({int? maxLength});
}
```

**PasswordGenerator Interface**
```dart
abstract class IPasswordGenerator {
  String generate(PasswordParams params);
}
```

### 6.2 Flutter Platform Channels
- Clipboard access via `flutter/services` package
- No external API dependencies

## 7. User Interface Design

### 7.1 Main Screen Layout
```
[App Bar]
[Password Display (Large Text)]
[Copy Button]
[Parameter Controls]
  - Word Count Slider
  - Toggle Switches for Options
  - Separator Input
[Regenerate Button]
[Settings Icon]
```

### 7.2 Responsive Behavior
- **≥5" Displays**: All controls visible without scrolling
- **<5" Displays**:
  - Vertical reflow with scrolling
  - Minimum 48dp touch targets
  - Font scaling according to accessibility settings

### 7.3 UI Components Specification
- **PasswordDisplayWidget**:
  - Read-only Text widget with 18sp minimum size
  - Visual feedback on copy action
- **ParameterControls**:
  - Slider for word count (1-10)
  - Material switches for Boolean options
  - TextField for separator (single char)
- **ActionButtons**:
  - Filled button for regeneration
  - IconButton for copying
  - Secondary button for settings

## 8. Security Architecture

### 8.1 Security Controls
- **Clipboard Management**:
  - Immediate password copy on action
  - No retention of clipboard history
  - Clear timeout not implemented (avoids requiring clipboard monitoring permission)
- **Data Protection**:
  - No storage of generated passwords
  - No analytics or telemetry
- **Code Protection**:
  - Release builds with `--obfuscate` flag
  - Debug modes disabled in production

### 8.2 Threat Mitigation
| Threat | Mitigation |
|--------|------------|
| Clipboard snooping | Educate users in app documentation |
| Dictionary tampering | SHA-256 checksum verification of word lists |
| UI redressing | Disable screen recording in sensitive views |

## 9. Performance and Scalability Design

### 9.1 Performance Optimization
- **Startup Time (≤1000ms)**:
  - Pre-load word lists in parallel
  - Defer non-essential initialization
  - Use isolate for word list loading if needed
- **Generation Time (≤200ms)**:
  - Memory-resident word lists
  - Optimized random selection algorithm
  - Pre-computed short word variants

### 9.2 Memory Management
- Single Activity architecture
- Dispose controllers properly
- Lazy initialization where possible
- Efficient data structures (Lists vs. Sets)

### 9.3 APK Size (≤5MB)
- Tree shaking enabled
- Minification of Dart code
- Compression of assets
- Selective resource inclusion

## 10. Error Handling and Resilience

### 10.1 Error Conditions
1. Word list loading failure
2. Invalid parameter combinations
3. Clipboard access exceptions
4. Settings read/write failures

### 10.2 Handling Strategy
- **Recovery**: Fallback to built-in defaults
- **User Feedback**: SnackBar notifications with clear messages
- **Logging**: Debug-mode logging of exceptions

### 10.3 Validation Rules
- Word count: 1 ≤ n ≤ 10
- Separator: Single character
- Length constraint: Must be ≥ n*4 (minimum word length)

## 11. Logging and Monitoring

### 11.1 Logging Strategy
- Debug builds: Verbose logging
- Release builds: Critical errors only
- Log elements:
  - Startup sequence
  - Word list loading
  - Generation performance metrics
  - Critical exceptions

### 11.2 Observability
- Basic Flutter framework logging
- No runtime monitoring (aligns with no-internet requirement)
- Console logs for debug purposes only

## 12. Testing Strategy

### 12.1 Unit Testing
- **PasswordGenerator**:
  - Verify all parameter combinations
  - Test boundary conditions
  - Validate length constraints
- **WordRepository**:
  - Test word loading
  - Verify random selection
  - Check length filtering

### 12.2 Widget Testing
- Verify all interactive controls
- Test copy functionality
- Validate settings persistence

### 12.3 Integration Testing
- Full generation workflow
- Settings modification flow
- Responsive layout verification

### 12.4 Performance Testing
- Startup time measurement
- Generation latency checks
- Memory usage profiling

## 13. Deployment Architecture

### 13.1 Build Pipeline
1. Flutter build with `--release --obfuscate`
2. Asset compilation:
   - Word list validation
   - Checksum generation
3. APK signing
4. F-droid metadata generation

### 13.2 Distribution
- F-droid repository only
- No alternative distribution channels
- Signed with F-droid build system keys

## 14. Development Guidelines

### 14.1 Code Structure
```
lib/
├── core/
│   ├── password_generator.dart
│   ├── word_repository.dart
│   └── settings_manager.dart
├── models/
│   └── password_params.dart
├── ui/
│   ├── main_screen.dart
│   └── settings_screen.dart
└── main.dart
```

### 14.2 Style Guide
- Dart Style Guide compliance
- 100% null-safety
- Documentation for public APIs
- Meaningful widget keys for testing

### 14.3 Dependency Management
- Minimal external packages
- Pinned versions in pubspec.yaml
- Security-reviewed dependencies

## 15. Technology Stack

### 15.1 Core Technologies
- Flutter 3.x (stable channel)
- Dart 3.x
- Material Design 3 components

### 15.2 Dependencies
- provider: ^6.0.5 (state management)
- shared_preferences: ^2.1.1 (settings persistence)
- flutter_bloc: Optional alternative (not selected due to simplicity needs)

### 15.3 Build Tools
- Flutter CLI
- Gradle for Android builds
- F-droid build server

## 16. Implementation Phases

### Phase 1: Core Functionality
- Password generation algorithm
- Basic UI layout
- Word list integration

### Phase 2: User Experience
- Parameter controls
- Clipboard integration
- Settings persistence

### Phase 3: Polishing
- Responsive layouts
- Error handling
- Performance optimization

### Phase 4: Release Prep
- Obfuscation
- Size optimization
- Testing completion

## 17. Risk Mitigation

| Risk | Mitigation Status |
|------|-------------------|
| Flutter performance | Benchmarked proof of concept |
| Dictionary loading | Pre-loading strategy implemented |
| Screen size issues | Comprehensive responsive testing plan |
| F-droid compliance | Early validation with metadata |

## 18. Appendices

### Appendix A: Word List Requirements
- Primary dictionary: 10k+ words, 4-12 characters
- Short word list: ≤500 words, 3-5 characters
- Format: Lowercase, one per line, UTF-8

### Appendix B: Performance Benchmarks
| Metric | Target | Reference Device |
|--------|--------|------------------|
| Cold start | ≤1000ms | Pixel 3a |
| Generation | ≤200ms | Samsung A12 |
| APK size | ≤5MB | N/A |

### Appendix C: State Diagram
```
[Initialization] → [Ready]
  ↓
[Generating] → [Displaying]
  ↑   ↓
[Settings Modified]
```

### Appendix D: Class Diagram
```
PasswordParams → PasswordGenerator
WordRepository → PasswordGenerator
SettingsManager ↔ UI
```
